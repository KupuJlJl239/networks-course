# Практика 3. Прикладной уровень

## Задачи

### Задача 1 (2 балла)
Голосовые сообщения отправляются от хоста А к хосту Б в сети с коммутацией пакетов в режиме
реального времени. Хост А преобразует на лету аналоговый голосовой сигнал в цифровой поток
битов, имеющий скорость $128$ Кбит/с, и разбивает его на $56$-байтные пакеты. Хосты А и Б
соединены одной линией связи, в которой скорость передачи данных равна $1$ Мбит/с, а задержка
распространения составляет $5$ мс. Как только хост А собирает пакет, он посылает его на хост Б,
который, в свою очередь, при получении всего пакета преобразует биты в аналоговый сигнал.
Сколько времени проходит с момента создания бита (из исходного аналогового сигнала на хосте
A) до момента его декодирования (превращения в часть аналогового сигнала на хосте Б)?

#### Решение

Нам дано:
* $L = 56$ байт - длина пакета
* $v = 128$ Кбит/с - скорость генерации битов
* $R = 1$ Мбит/с - скорость канала
* $\tau$ = $5$ мс - задержка распространения

Заметим, что искомое время не зависит от номера бита, так как на хосте B аудио воспроизводится с той же скоростью, с какой генерируется на A. 

Посчитаем это время для первого бита в пакете.
После его генерации должны сформироваться все остальные биты пакета, на это уйдёт время $\frac{L}{v}$, потом пакет должен поступить в канал целиком, на это понадобится $\frac{L}{R}$, потом через время $\tau$ хост B получит весь пакет и поскольку наш бит - первый в пакете, он тут же будет воспроизведён.

Ответ: $\frac{L}{v} + \frac{L}{R} + \tau = 8.948$ мс


### Задача 2 (2 балла)
Рассмотрим буфер маршрутизатора, где пакеты хранятся перед передачей их в исходящую линию
связи. В этой задаче вы будете использовать широко известную из теории массового
обслуживания (или теории очередей) формулу Литтла. Пусть $N$ равно среднему числу пакетов в
буфере плюс пакет, который передается в данный момент. Обозначим через $a$ скорость
поступления пакетов в буфер, а через $d$ – среднюю общую задержку (т.е. сумму задержек
ожидания и передачи), испытываемую пакетом. Согласно формуле Литтла $N = a \cdot d$.
Предположим, что в буфере содержится в среднем $10$ пакетов, а средняя задержка ожидания для
пакета равна $10$ мс. Скорость передачи по линии связи составляет $100$ пакетов в секунду.
Используя формулу Литтла, определите среднюю скорость поступления пакета в очередь,
предполагая, что потери пакетов отсутствуют.

#### Решение
Нам дано:
* $N = 10$ пакетов - среднее число пакетов в буфере
* $b = 100$ пакетов/c - скорость исходящей линии связи
* $t = 10$ мс - средняя задержка ожидания 

Обозначим также:
* $\tau = 1/b$ - задержка передачи одного пакета
* $d = t + \tau$ - средняя общая задержка
* $a$ (пакетов/с) - искомая скорость поступления пакета в очередь

Среднее число передающихся пакетов равно $a/b (\le 1)$, так как весь передающийся поток равен $a$, а передача одного пакета занимает $\tau = 1/b$. Итого среднее число пакетов в буфере или передающихся равно $N+a/b$.

По формуле Литтла:
$N + a/b = (t + 1/b)*a $
$Nb + a = (tb + 1)*a $
$Nb = (tb)*a $
$a = N/t = 1000$ пакетов/с

Получается, $a > b$, входящая скорость больше исходящей, и пакеты будут бесконечно накапливаться, что противоречит условию.


Ответ: такого не бывает.

### Задача 3 (2 балла)
Рассмотрим рисунок.

<img src="images/task3.png" width=500 />

Предположим, нам известно, что на маршруте от сервера до клиента узким местом
является первая линия связи, скорость передачи данных по которой равна $R_S$ бит/с.
Допустим, что мы отправляем два пакета друг за другом от сервера клиенту, и другой
трафик на маршруте отсутствует. Размер каждого пакета составляет $L$ бит, а скорость
распространения сигнала по обеим линиям равна $d_{\text{распространения}}$.
1. Какова временная разница прибытия пакетов к месту назначения? То есть, сколько
времени пройдет от момента получения клиентом последнего бита первого пакета до
момента получения последнего бита второго пакета?
2. Теперь предположим, что узким местом является вторая линия связи (то есть $R_C < R_S$).
Может ли второй пакет находиться во входном буфере, ожидая передачи во вторую
линию? Почему? Если предположить, что сервер отправляет второй пакет, спустя $T$ секунд
после отправки первого, то каково должно быть минимальное значение $T$, чтобы очередь
во вторую линию связи была нулевая? Обоснуйте ответ.

#### Решение
В последовательном соединении с разными скоростями каналов задержка между пакетами у принимающей стороны (т.е. время между получением первого бита одного пакета и получением первого бита следующего пакета, отправленного сразу же за первым) всегда оказывается равна максимальной из задержек передачи на всём пути.

(конечно, если считать что трафик однонаправленный, а маршрутизатор при получении пакета мгновенно пересылает его или кладёт в очередь если отправляется другой пакет, и все пакеты одинаковы по размеру. В нашем случае всё это верно.)

1. Время между получением начал пакетов равно $L/R_S$ - задержка передачи более медленного первого канала. Время между получением начала и конца первого пакета равно задержке передачи второго канала $L/R_C$. Таким образом, то о чём спрашивали равно разности этих величин - $L/R_S - L/R_C$.
2. Да, второй пакет может находиться в буфере, так как первый пакет по более медленному второму каналу может отправляться дольше, чем по более быстрому первому придёт второй пакет. 
Найдём минимальное время $T$. Мы знаем, что задержка между пакетами у принимающей стороны всегда не более $L/R_C$, а поскольку мы рассматриваем предельный случай, то задержка такая и есть. Раз очереди не было, значит задержка между пакетами на входе такая же. Первый пакет отправляется $L/R_S$, а после начала его отправки через $L/R_C$ начинает отправляться второй пакет. Значит $T = L/R_C - L/R_S$.

Ответ: 
1) $L/R_S - L/R_C$ 
2) $T = L/R_C - L/R_S$


### Задача 4 (4 балла)

<img src="images/task4.png" width=400 />

На рисунке показана сеть организации, подключенная к Интернету:
Предположим, что средний размер объекта равен $850000$ бит, а средняя скорость
запросов от браузеров этой организации к веб-серверам составляет $16$ запросов в секунду.
Предположим также, что количество времени, прошедшее с момента, когда внешний
маршрутизатор организации пересылает запрос HTTP, до момента, пока он не получит
ответ, равно в среднем три секунды. Будем считать, что общее среднее время ответа
равно сумме средней задержки доступа (то есть, задержки от маршрутизатора в
Интернете до маршрутизатора организации) и средней задержки в Интернете. Для
средней задержки доступа используем формулу $\dfrac{\Delta}{1 - \Delta \cdot B}$, 
где $\Delta$ – это среднее время, необходимое для отправки объекта по каналу связи, 
а B – частота поступления объектов в линию связи.
1. Найдите $\Delta$ (это среднее время, необходимое для отправки объекта по каналу связи).
2. Найдите общее среднее время ответа.
3. Предположим, что в локальной сети организации присутствует кэширующий
сервер. Пусть коэффициент непопадания в кэш равен $0.4$. Найдите общее время ответа.

#### Решение
Нам дано:
* $L = 850000$ бит - длина объекта
* $B = 16$ - запросов и ответов в секунду
* $\mu = 0.4$
* $R = 15$ Мбит/с - скорость канала доступа
* $\tau = 3$ с - задержка в интернете

1. Узкое место в соединении между локальной сетью и интернетом - канал доступа со скоростью $R$.
Поэтому суммарная задержка отправки - это задержка передачи, которую мы бы получили отправляя один объект по этому каналу, она равна $L/R$. Итак, $\Delta = L/R = 56.666$ мс.

2. Согласно условию общее среднее время ответа равно $t = \tau + \dfrac{\Delta}{1 - \Delta \cdot B} = 3.607$ с.

3. Теперь в линию в интернет поступает не $B$ запросов в секунду, а $\mu B$. Получается, что в этом случае $t = \tau + \dfrac{\Delta}{1 - \Delta \cdot \mu B} = 3.089$ с.

Ответ: 
1. $\Delta = L/R = 56.666$ мс
2. $t = \tau + \dfrac{\Delta}{1 - \Delta \cdot B} = 3.607$ с
3. $t = \tau + \dfrac{\Delta}{1 - \Delta \cdot \mu B} = 3.089$ с